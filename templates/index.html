<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8">
<title>CERCO AI • Painel Preditivo Jardim Camburi</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
  body {
    background: #0b1220;
    color: #e4e6eb;
    font-family: 'Inter', system-ui, sans-serif;
  }

  .card-dark {
    background: #141b2d;
    border: 1px solid rgba(255,255,255,0.08);
    border-radius: 14px;
    padding: 1.2rem;
    box-shadow: 0 0 25px rgba(0,0,0,0.35);
  }

  .kpi-value {
    font-size: 2rem;
    font-weight: 700;
  }

  .kpi-label {
    color: #8f9bb3;
    font-size: 0.8rem;
    letter-spacing: 0.04em;
    text-transform: uppercase;
  }

  .titulo-secao {
    font-size: 1.1rem;
    font-weight: 600;
    color: #c7d0e0;
    margin-bottom: 0.6rem;
  }

  .badge-risk-high {
    background: #b91c1c;
  }

  .badge-risk-med {
    background: #ca8a04;
  }

  .badge-risk-low {
    background: #1d4ed8;
  }

  .tag {
    padding: 3px 9px;
    border-radius: 8px;
    font-size: 0.75rem;
    font-weight: 500;
    background: rgba(255,255,255,0.08);
  }

  .lista-item {
    padding: 6px 0;
    border-bottom: 1px solid rgba(255,255,255,0.05);
  }

  .projecao-box {
    border-left: 4px solid #3b82f6;
    padding-left: 12px;
    margin-bottom: 10px;
  }

</style>
</head>

<body>
<div class="container py-4">

  <!-- Cabeçalho -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <h2 class="fw-bold mb-0">CERCO AI • Painel Preditivo</h2>
      <small class="text-secondary">Jardim Camburi — atualizado em {{ ultima_atualizacao }}</small>
    </div>
    <div>
      <span class="tag">Modelo N7 • Forecast 24h</span>
      <span class="tag">Google Drive API</span>
    </div>
  </div>

  <!-- KPIs -->
  <div class="row g-3 mb-4">
    {% for k in kpis %}
    <div class="col-6 col-md-3">
      <div class="card-dark">
        <div class="kpi-value">{{ k.valor }}</div>
        <div class="kpi-label">{{ k.nome }}</div>
      </div>
    </div>
    {% endfor %}
  </div>


  <!-- 3 COLUNAS PRINCIPAIS -->
  <div class="row g-4">

    <!-- HORÁRIOS DE MAIOR RISCO -->
    <div class="col-lg-4">
      <div class="card-dark h-100">
        <div class="titulo-secao">Horários mais críticos</div>

        {% if top_horarios %}
          {% for h in top_horarios %}
          <div class="lista-item d-flex justify-content-between">
            <span>{{ h.hora }}h</span>
            <span class="badge {% if h.risco=='alto' %}badge-risk-high{% elif h.risco=='medio' %}badge-risk-med{% else %}badge-risk-low{% endif %}">
              {{ h.risco | capitalize }}
            </span>
          </div>
          {% endfor %}
        {% else %}
          <small class="text-secondary">Sem dados suficientes.</small>
        {% endif %}
      </div>
    </div>

    <!-- LOGRADOUROS -->
    <div class="col-lg-4">
      <div class="card-dark h-100">
        <div class="titulo-secao">Logradouros com maior incidência</div>

        {% if top_logradouros %}
          {% for l in top_logradouros %}
          <div class="lista-item d-flex justify-content-between">
            <span>{{ l.logradouro }}</span>
            <strong>{{ l.total }}</strong>
          </div>
          {% endfor %}
        {% else %}
          <small class="text-secondary">Sem dados.</small>
        {% endif %}
      </div>
    </div>

    <!-- TENDÊNCIAS -->
    <div class="col-lg-4">
      <div class="card-dark h-100">
        <div class="titulo-secao">Tendências (últimas semanas)</div>

        {% if tendencias %}
          {% for t in tendencias %}
          <div class="lista-item d-flex justify-content-between">
            <span>{{ t.nome }}</span>
            <span class="{% if t.movimento=='alta' %}text-danger{% elif t.movimento=='queda' %}text-success{% endif %}">
              {{ t.movimento | capitalize }} ({{ t.percent }}%)
            </span>
          </div>
          {% endfor %}
        {% else %}
          <small class="text-secondary">Nenhuma tendência detectada.</small>
        {% endif %}
      </div>
    </div>
  </div>


  <!-- PROJEÇÃO 24H E SAZONALIDADE -->
  <div class="row g-4 mt-2">

    <!-- PROJEÇÃO 24H -->
    <div class="col-lg-6">
      <div class="card-dark">
        <div class="titulo-secao">Projeção de Ocorrências — Próximas 24h</div>

        {% if projecoes_24h %}
          {% for p in projecoes_24h %}
          <div class="projecao-box">
            <div><strong>{{ p.hora }}h</strong> — risco {{ p.risco }}</div>
            <small class="text-secondary">Estimado: {{ p.valor_previsto }}</small>
          </div>
          {% endfor %}
        {% else %}
          <small class="text-secondary">Sem projeções calculadas.</small>
        {% endif %}
      </div>
    </div>

    <!-- SAZONALIDADE / PADRÕES -->
    <div class="col-lg-6">
      <div class="card-dark">
        <div class="titulo-secao">Sazonalidade & Padrões</div>

        {% if sazonalidade %}
          {% for s in sazonalidade %}
          <div class="lista-item">
            <strong>{{ s.padrao }}</strong><br>
            <small class="text-secondary">{{ s.descricao }}</small>
          </div>
          {% endfor %}
        {% else %}
          <small class="text-secondary">Nenhum padrão detectado.</small>
        {% endif %}
      </div>
    </div>

  </div>


  <!-- ALERTAS AUTOMÁTICOS -->
  <div class="row mt-4">
    <div class="col-12">
      <div class="card-dark">
        <div class="titulo-secao">Alertas Inteligentes</div>

        {% if alertas %}
          {% for a in alertas %}
          <div class="lista-item">
            <strong>{{ a.titulo }}</strong>
            <div class="text-secondary small">{{ a.descricao }}</div>
          </div>
          {% endfor %}
        {% else %}
          <small class="text-secondary">Nenhum alerta crítico no momento.</small>
        {% endif %}
      </div>
    </div>
  </div>

</div>
</body>
</html>
